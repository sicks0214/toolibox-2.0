# 导航页 + 工具页面 + 插件系统需求文档 v2.0

（支持多语言 / 动态工具渲染 / 插件化后端 / 单体前端）

> 本文档设计目标：
> **让你可以无限扩展工具（PDF / Image / Future Tools），前端不用改、导航不用改，后端自动加载，SEO 满分。**

---

# 0. 总体架构图（最终形态）

```
┌──────────────────────────────────────────────┐
│                前端（Next.js 单体）           │
│──────────────────────────────────────────────│
│ /[lang]/                         ← 导航页       │
│ /[lang]/pdf-tools                ← 分类页       │
│ /[lang]/pdf-tools/[slug]         ← 工具页动态渲染│
│ /[lang]/image-tools/[slug]       ← 工具页动态渲染│
└──────────────────────────────────────────────┘
                     │ API 调用
┌──────────────────────────────────────────────┐
│                后端（Express 单体 API）         │
│──────────────────────────────────────────────│
│ /api/plugins?lang=en               ← 工具元数据API │
│ /api/{category}/{slug}             ← 工具处理API    │
└──────────────────────────────────────────────┘
                     │ 动态加载
┌──────────────────────────────────────────────┐
│                插件层（Tools Plugins）        │
│──────────────────────────────────────────────│
│ /plugins/{tool}/plugin.json         ← 配置       │
│ /plugins/{tool}/ui.json             ← UI + SEO    │
│ /plugins/{tool}/schema.json         ← 工具UI结构   │
│ /plugins/{tool}/handler.ts          ← 工具逻辑     │
└──────────────────────────────────────────────┘
```

---

# 1. 目录结构（最终版本）

```
/project-root
  /frontend        ← Next.js 项目
    /app
      /[lang]
        /page.jsx                  ← 导航页
        /pdf-tools/[slug]/page.jsx ← 工具页（动态渲染）
        /image-tools/[slug]/page.jsx
    /locales
      en.json
      zh.json
      es.json

  /backend         ← Express/Fastify 项目
    /routes
      plugins.js                   ← 加载插件列表
      dynamic-tools.js             ← 自动注册工具API
    /plugin-loader.js              ← 插件扫描核心

  /plugins
    /pdf-merge
      plugin.json
      ui.json
      schema.json
      handler.ts
    /pdf-split
      ...
    /image-resize
      ...
```

---

# 2. 前端（Next.js）需求

## 2.1 URL 国际化结构

```
/[lang]/
/[lang]/pdf-tools
/[lang]/pdf-tools/[slug]
/[lang]/image-tools/[slug]
```

支持语言：

```
en, zh, es
```

如果访问 `/jp/` → fallback `/en/`

---

## 2.2 导航页渲染流程

导航页 `/[lang]/page.jsx` 需要：

1. 从 URL 解析 lang
2. 调用后端：

```
GET /api/plugins?lang=zh
```

3. 得到所有工具列表（已按语言处理）
4. 按 category 分组：pdf/image
5. 渲染工具卡片
6. 加载语言包 `/locales/zh.json`
7. 渲染 UI 文案（标题、搜索框文字等）

---

## 2.3 工具页动态渲染流程

路径：

```
/[lang]/pdf-tools/[slug]
```

流程：

1. 解析 `{lang}` 与 `{slug}`
2. 调用：

```
GET /api/plugins/{slug}?lang=zh
```

返回：

* ui.json（当前语言部分）
* schema.json（用于前端生成 UI）
* plugin.json（基础信息）

3. 前端根据 schema.json 自动渲染 UI：

### schema.json示例

```json
{
  "upload": { "multiple": true, "types": ["pdf"] },
  "options": [
    { "name": "rotate", "type": "number", "label": {"en": "Rotate:", "zh": "旋转角度："} }
  ],
  "submitText": {
    "en": "Merge PDF",
    "zh": "合并 PDF"
  }
}
```

4. 用户点击按钮 → POST 到：

```
POST /api/pdf/merge
```

后端执行 handler.ts。

---

## 2.4 前端 SEO 需求（多语言必须独立）

每个工具页必须：

```html
<title>{ui.title[lang]}</title>
<meta name="description" content="{ui.description[lang]}" />
<link rel="canonical" href="/{lang}/pdf-tools/{slug}" />
<link rel="alternate" hreflang="en" href="/en/pdf-tools/{slug}" />
<link rel="alternate" hreflang="zh" href="/zh/pdf-tools/{slug}" />
<link rel="alternate" hreflang="es" href="/es/pdf-tools/{slug}" />
```

---

# 3. 后端（Express）需求

## 3.1 API 路由结构

```
/api/plugins                 ← 返回所有工具（多语言）
/api/plugins/{slug}          ← 返回某个工具的配置
/api/{category}/{slug}       ← 调用工具 handler.ts
```

---

## 3.2 plugins loader（核心）

`plugin-loader.js` 必须：

1. 扫描 `/plugins/*`
2. 读取：

* plugin.json
* ui.json
* schema.json

3. 返回统一格式

### plugin.json 结构

```json
{
  "name": "Merge PDF",
  "slug": "merge",
  "category": "pdf",
  "apiPath": "/api/pdf/merge",
  "order": 1
}
```

### ui.json 多语言结构

```json
{
  "title": { "en": "Merge PDF", "zh": "合并 PDF" },
  "description": { "en": "...", "zh": "..." },
  "h1": { "en": "Merge PDF", "zh": "合并 PDF" },
  "faq": {
    "en": [...],
    "zh": [...]
  }
}
```

---

## 3.3 自动挂载工具 handler

后端启动时执行：

```javascript
for each plugin:
  app.post(`/api/${plugin.category}/${plugin.slug}`, plugin.handler)
```

handler.ts 示例：

```typescript
module.exports = async (req, res) => {
  const files = req.files;
  const result = await mergePDF(files);
  res.sendFile(result);
}
```

---

# 4. 插件系统需求（最核心）

每个插件必须是自包含的目录：

```
/plugins/{tool}/
```

包含：

## 4.1 plugin.json（必须）

```json
{
  "slug": "merge",
  "category": "pdf",
  "order": 1
}
```

## 4.2 ui.json（必须，多语言）

工具标题、描述、FAQ、SEO 全在其中。

## 4.3 schema.json（必须）

定义工具前端 UI：

* 文件上传
* 参数设置
* 按钮文字
* 输出类型（file/json）

## 4.4 handler.ts（必须）

工具的实际业务逻辑：

* 文件处理
* 转换
* 合并
* 压缩

所有业务逻辑必须在后端执行，不得在前端运行。

---

# 5. 类型规范（必须统一）

## 5.1 工具分类

```
pdf
image
```

未来可扩展：

```
video
text
ai
```

## 5.2 API 输入格式（统一）

POST FormData：

```
files[]  文件数组
options  JSON  (参数)
```

## 5.3 API 输出格式

成功：

* 单个文件 → attachment
* 多文件 → zip

失败：

```json
{ "error": true, "message": "Invalid PDF" }
```

---

# 6. 国际化需求（i18n）

### 6.1 URL 必须带语言前缀

### 6.2 语言 JSON 文件统一存储在 /frontend/locales

### 6.3 插件层提供多语言 UI

### 6.4 API 返回内容按语言过滤

### 6.5 工具页 SEO 按语言独立输出

### 6.6 hreflang 必须支持所有语言

---

# 7. 搜索系统需求（导航页）

搜索必须：

* 按多语言名称搜索
* 按 description 搜索
* 按 slug 搜索
* 即时过滤结果

---

# 8. 可扩展性要求

新增工具时：

* 只需新增 `/plugins/{tool}/` 目录
* 导航页自动识别
* 工具页自动生成
* API 自动挂载
* SEO 自动生成

前端 **不需要写任何代码**。

---

# 9. 安全与隐私需求

* 所有文件处理在后端完成
* 文件上传大小限制
* R2 临时文件 2 小时自动删除
* 后端对文件类型验证（必须）

---

# 10. 部署需求

* 前端构建 Next.js → 静态 + SSR 混合
* 后端 Express 单体部署
* 所有工具通过插件自动扩展
* 同一台 VPS 即可
* 导航页与工具页不需要独立部署

---

# 11. 验收标准（权威版）

## ✔ 导航页

* 多语言支持
* 工具自动渲染
* 搜索可用

## ✔ 工具页

* 动态生成
* schema.json UI 正确渲染
* SEO 正确输出
* FAQ 正常显示

## ✔ 后端

* 自动加载插件
* 正确挂载工具
* API 能工作

## ✔ 插件

* plugin.json、ui.json、schema.json、handler.ts 结构完整
* 工具能独立运行

## ✔ SEO

* 每语言独立 title/desc
* hreflang 正确
* canonical 正确

---

