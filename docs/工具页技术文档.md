# TooliBox å·¥å…·é¡µæŠ€æœ¯æ–‡æ¡£

## ä¸€ã€æ¦‚è¿°

å·¥å…·é¡µæ˜¯ç”¨æˆ·ä¸å…·ä½“å·¥å…·äº¤äº’çš„æ ¸å¿ƒé¡µé¢ï¼Œè´Ÿè´£å±•ç¤ºå·¥å…·ä¿¡æ¯ã€æ¸²æŸ“åŠ¨æ€è¡¨å•ã€å¤„ç†æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½ã€‚

### è·¯ç”±ç»“æ„

```
/{locale}/{categoryId}/{slug}
ä¾‹å¦‚: /zh/pdf-tools/compress
```

| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|-----|------|------|
| locale | è¯­è¨€ä»£ç  | en, zh, es |
| categoryId | åˆ†ç±» ID | pdf-tools, image-tools |
| slug | å·¥å…·å”¯ä¸€æ ‡è¯† | compress, merge |

---

## äºŒã€é¡µé¢æ¶æ„

### æ–‡ä»¶ä½ç½®

```
frontend/main/src/
â”œâ”€â”€ app/[locale]/[categoryId]/[slug]/
â”‚   â””â”€â”€ page.tsx              # å·¥å…·é¡µä¸»ç»„ä»¶
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ tool/
â”‚   â”‚   â””â”€â”€ SchemaRenderer.tsx  # è¡¨å•æ¸²æŸ“å™¨
â”‚   â””â”€â”€ layout/
â”‚       â””â”€â”€ Breadcrumb.tsx      # é¢åŒ…å±‘å¯¼èˆª
â””â”€â”€ lib/
    â””â”€â”€ api.ts                  # API è°ƒç”¨å°è£…
```

### é¡µé¢ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Header                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Breadcrumb (é¦–é¡µ > åˆ†ç±» > å·¥å…·)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           å·¥å…·å›¾æ ‡                   â”‚
â”‚           å·¥å…·æ ‡é¢˜ (h1)              â”‚
â”‚           å·¥å…·æè¿°                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚      SchemaRenderer           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚    æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ          â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚    å·²é€‰æ–‡ä»¶åˆ—è¡¨          â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚    é€‰é¡¹è¡¨å•              â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚    æäº¤æŒ‰é’®              â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           FAQ åŒºåŸŸ                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚            Footer                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€æ ¸å¿ƒç»„ä»¶

### 3.1 å·¥å…·é¡µä¸»ç»„ä»¶ (page.tsx)

ä½ç½®ï¼š`frontend/main/src/app/[locale]/[categoryId]/[slug]/page.tsx`

#### åŠŸèƒ½

1. æœåŠ¡ç«¯è·å–æ’ä»¶æ•°æ®
2. ç”Ÿæˆ SEO å…ƒæ•°æ®
3. æ¸²æŸ“é¡µé¢å¸ƒå±€

#### å…³é”®ä»£ç 

```typescript
interface ToolPageProps {
  params: {
    categoryId: string;
    slug: string;
    locale: string;
  };
}

export default async function ToolPage({ params }: ToolPageProps) {
  const { categoryId, slug, locale } = params;

  // è·å–æ’ä»¶æ•°æ®
  const response = await fetchPlugin(slug, locale);
  if (!response.success) {
    notFound();
  }
  const plugin = response.data;

  return (
    <div className="flex flex-col min-h-screen">
      <Header />
      <main className="flex-1 container mx-auto px-4 py-8">
        <Breadcrumb items={[...]} />

        {/* å·¥å…·æ ‡é¢˜åŒº */}
        <div className="text-center mb-8">
          <span className="text-6xl">{plugin.icon}</span>
          <h1>{plugin.h1 || plugin.title}</h1>
          <p>{plugin.description}</p>
        </div>

        {/* å·¥å…·æ“ä½œåŒº */}
        <SchemaRenderer plugin={plugin} locale={locale} />

        {/* FAQ åŒºåŸŸ */}
        {plugin.faq && <FAQSection faq={plugin.faq} />}
      </main>
      <Footer />
    </div>
  );
}
```

#### SEO å…ƒæ•°æ®ç”Ÿæˆ

```typescript
export async function generateMetadata({ params }: ToolPageProps): Promise<Metadata> {
  const plugin = await fetchPlugin(slug, locale);

  return {
    title: `${plugin.title} - Toolibox`,
    description: plugin.description,
    alternates: {
      canonical: canonicalUrl,
      languages: {
        'en': `${baseUrl}/en/${categoryId}/${slug}`,
        'zh': `${baseUrl}/zh/${categoryId}/${slug}`,
        'es': `${baseUrl}/es/${categoryId}/${slug}`,
      }
    },
    openGraph: { ... }
  };
}
```

---

### 3.2 è¡¨å•æ¸²æŸ“å™¨ (SchemaRenderer)

ä½ç½®ï¼š`frontend/main/src/components/tool/SchemaRenderer.tsx`

#### åŠŸèƒ½

æ ¹æ®æ’ä»¶çš„ `schema.json` é…ç½®åŠ¨æ€æ¸²æŸ“ï¼š
- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸï¼ˆæ”¯æŒæ‹–æ‹½ï¼‰
- é€‰é¡¹è¡¨å•ï¼ˆselectã€numberã€textã€range ç­‰ï¼‰
- æäº¤æŒ‰é’®
- å¤„ç†æ–‡ä»¶ä¸‹è½½

#### Props æ¥å£

```typescript
interface SchemaRendererProps {
  plugin: PluginData;
  locale: string;
}
```

#### çŠ¶æ€ç®¡ç†

```typescript
const [files, setFiles] = useState<File[]>([]);      // å·²é€‰æ–‡ä»¶
const [options, setOptions] = useState<Record<string, any>>({});  // è¡¨å•é€‰é¡¹
const [loading, setLoading] = useState(false);       // åŠ è½½çŠ¶æ€
const [error, setError] = useState<string | null>(null);  // é”™è¯¯ä¿¡æ¯
```

#### æ–‡ä»¶ä¸Šä¼ 

ä½¿ç”¨ `react-dropzone` å®ç°æ‹–æ‹½ä¸Šä¼ ï¼š

```typescript
const { getRootProps, getInputProps, isDragActive } = useDropzone({
  onDrop,
  accept: getAcceptTypes(schema.upload.types),  // MIME ç±»å‹
  maxSize: schema.upload.maxSize,               // æœ€å¤§æ–‡ä»¶å¤§å°
  multiple: schema.upload.multiple              // æ˜¯å¦å¤šé€‰
});
```

#### è¡¨å•æäº¤æµç¨‹

```typescript
const handleSubmit = async () => {
  // 1. éªŒè¯æ–‡ä»¶
  if (files.length === 0) {
    setError('è¯·å…ˆä¸Šä¼ æ–‡ä»¶');
    return;
  }

  // 2. æ„å»º FormData
  const formData = new FormData();
  if (schema.upload.multiple) {
    files.forEach((file) => formData.append('files', file));
  } else {
    formData.append('file', files[0]);
  }
  Object.entries(options).forEach(([key, value]) => {
    formData.append(key, String(value));
  });

  // 3. è°ƒç”¨ API
  const blob = await submitToolRequest(apiPath, formData);

  // 4. è§¦å‘ä¸‹è½½
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = getOutputFilename(plugin);
  a.click();
  URL.revokeObjectURL(url);
};
```

#### é€‰é¡¹ç±»å‹æ¸²æŸ“

| type | æ¸²æŸ“ç»„ä»¶ | é¢å¤–å±æ€§ |
|------|---------|---------|
| select | `<select>` | choices |
| number | `<input type="number">` | placeholder |
| text | `<input type="text">` | placeholder |
| range | `<input type="range">` | min, max, default |

---

### 3.3 é¢åŒ…å±‘å¯¼èˆª (Breadcrumb)

ä½ç½®ï¼š`frontend/main/src/components/layout/Breadcrumb.tsx`

```typescript
interface BreadcrumbItem {
  label: string;
  href?: string;  // æ—  href è¡¨ç¤ºå½“å‰é¡µ
}

// ä½¿ç”¨ç¤ºä¾‹
<Breadcrumb
  items={[
    { label: 'é¦–é¡µ', href: `/${locale}` },
    { label: 'PDF å·¥å…·', href: `/${locale}/pdf-tools` },
    { label: 'å‹ç¼© PDF' }  // å½“å‰é¡µï¼Œæ— é“¾æ¥
  ]}
/>
```

---

## å››ã€æ•°æ®æµ

### å®Œæ•´æ•°æ®æµç¨‹

```
1. ç”¨æˆ·è®¿é—® /zh/pdf-tools/compress
         â†“
2. Next.js è·¯ç”±åŒ¹é… [locale]/[categoryId]/[slug]/page.tsx
         â†“
3. æœåŠ¡ç«¯è°ƒç”¨ fetchPlugin('compress', 'zh')
         â†“
4. åç«¯è¿”å›æ’ä»¶é…ç½® (plugin.json + ui.json + schema.json)
         â†“
5. é¡µé¢æ¸²æŸ“ï¼ŒSchemaRenderer æ ¹æ® schema ç”Ÿæˆè¡¨å•
         â†“
6. ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶ï¼Œå¡«å†™é€‰é¡¹
         â†“
7. ç‚¹å‡»æäº¤ï¼Œè°ƒç”¨ POST /api/pdf/compress
         â†“
8. åç«¯ handler å¤„ç†æ–‡ä»¶
         â†“
9. è¿”å›å¤„ç†åçš„æ–‡ä»¶ (Blob)
         â†“
10. å‰ç«¯è§¦å‘æµè§ˆå™¨ä¸‹è½½
```

### API è°ƒç”¨

```typescript
// è·å–æ’ä»¶ä¿¡æ¯
GET /api/plugins/{slug}?lang={locale}

// å“åº”
{
  "success": true,
  "data": {
    "slug": "compress",
    "category": "pdf",
    "apiPath": "/api/pdf/compress",
    "title": "å‹ç¼© PDF",
    "description": "...",
    "icon": "ğŸ—œï¸",
    "h1": "åœ¨çº¿å‹ç¼© PDF",
    "faq": [...],
    "schema": {
      "upload": { ... },
      "options": [ ... ],
      "submitText": "å‹ç¼© PDF",
      "outputType": "file"
    }
  }
}

// æäº¤å·¥å…·è¯·æ±‚
POST /api/{category}/{slug}
Content-Type: multipart/form-data

file: <binary>
option1: value1
option2: value2
```

---

## äº”ã€PluginData ç±»å‹å®šä¹‰

```typescript
export interface PluginData {
  slug: string;           // å·¥å…·å”¯ä¸€æ ‡è¯†
  category: string;       // åˆ†ç±»: pdf, image
  apiPath: string;        // API è·¯å¾„
  order: number;          // æ’åº
  title: string;          // æ ‡é¢˜ (å·²æœ¬åœ°åŒ–)
  description: string;    // æè¿° (å·²æœ¬åœ°åŒ–)
  h1: string;             // H1 æ ‡é¢˜ (å·²æœ¬åœ°åŒ–)
  icon: string;           // å›¾æ ‡ emoji
  faq: Array<{            // FAQ åˆ—è¡¨ (å·²æœ¬åœ°åŒ–)
    question: string;
    answer: string;
  }>;
  schema: {
    upload: {
      multiple: boolean;  // æ˜¯å¦å¤šæ–‡ä»¶
      maxFiles: number;   // æœ€å¤§æ–‡ä»¶æ•°
      types: string[];    // å…è®¸çš„ MIME ç±»å‹
      maxSize: number;    // æœ€å¤§æ–‡ä»¶å¤§å° (å­—èŠ‚)
    };
    options: Array<{      // è¡¨å•é€‰é¡¹
      name: string;
      type: string;       // select, number, text, range
      label: string;
      placeholder?: string;
      min?: number;
      max?: number;
      default?: any;
      choices?: Array<{ value: string; label: string }>;
    }>;
    submitText: string;   // æäº¤æŒ‰é’®æ–‡æœ¬ (å·²æœ¬åœ°åŒ–)
    outputType: string;   // è¾“å‡ºç±»å‹: file, zip
  };
}
```

---

## å…­ã€åˆ†ç±»æ˜ å°„

```typescript
// categoryId -> category
const categoryMap: Record<string, string> = {
  'pdf-tools': 'pdf',
  'image-tools': 'image'
};

// categoryId -> æ˜¾ç¤ºåç§°
const categoryNames: Record<string, Record<string, string>> = {
  'pdf-tools': {
    en: 'PDF Tools',
    zh: 'PDF å·¥å…·',
    es: 'Herramientas PDF'
  },
  'image-tools': {
    en: 'Image Tools',
    zh: 'å›¾åƒå·¥å…·',
    es: 'Herramientas de imagen'
  }
};
```

---

## ä¸ƒã€é”™è¯¯å¤„ç†

### 404 å¤„ç†

```typescript
// æ’ä»¶ä¸å­˜åœ¨æ—¶è¿”å› 404
const response = await fetchPlugin(slug, locale);
if (!response.success) {
  notFound();  // Next.js å†…ç½® 404 é¡µé¢
}
```

### è¡¨å•é”™è¯¯

```typescript
// SchemaRenderer ä¸­çš„é”™è¯¯æ˜¾ç¤º
{error && (
  <div className="bg-red-50 text-red-600 p-3 rounded-lg text-sm">
    {error}
  </div>
)}
```

### å¤šè¯­è¨€é”™è¯¯æç¤º

```typescript
const errorMessages = {
  noFile: {
    en: 'Please upload a file first',
    zh: 'è¯·å…ˆä¸Šä¼ æ–‡ä»¶',
    es: 'Por favor sube un archivo primero'
  }
};
```

---

## å…«ã€æ ·å¼è§„èŒƒ

### ä¸»è¦æ ·å¼ç±»

| åŒºåŸŸ | æ ·å¼ |
|-----|------|
| å·¥å…·å¡ç‰‡ | `bg-white rounded-2xl shadow-lg p-8` |
| ä¸Šä¼ åŒºåŸŸ | `border-2 border-dashed rounded-xl p-8` |
| æäº¤æŒ‰é’® | `w-full py-3 px-6 bg-primary text-white rounded-lg` |
| FAQ åŒºåŸŸ | `bg-gray-50 rounded-2xl p-8` |

### çŠ¶æ€æ ·å¼

```css
/* æ‹–æ‹½æ¿€æ´» */
.dropzone-active {
  border-color: var(--primary);
  background-color: rgba(var(--primary-rgb), 0.05);
}

/* æŒ‰é’®ç¦ç”¨ */
.button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}
```

---

## ä¹ã€æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°çš„é€‰é¡¹ç±»å‹

1. åœ¨ `schema.json` ä¸­å®šä¹‰æ–°ç±»å‹
2. åœ¨ `SchemaRenderer.tsx` çš„ `renderOptionInput` å‡½æ•°ä¸­æ·»åŠ æ¸²æŸ“é€»è¾‘

```typescript
function renderOptionInput(opt, value, onChange) {
  switch (opt.type) {
    case 'color':  // æ–°å¢é¢œè‰²é€‰æ‹©å™¨
      return (
        <input
          type="color"
          value={value || '#000000'}
          onChange={(e) => onChange(e.target.value)}
        />
      );
    // ... å…¶ä»–ç±»å‹
  }
}
```

### æ·»åŠ æ–°çš„è¾“å‡ºç±»å‹

1. ä¿®æ”¹ `getOutputFilename` å‡½æ•°
2. æ ¹æ® `schema.outputType` è¿”å›æ­£ç¡®çš„æ–‡ä»¶æ‰©å±•å

```typescript
function getOutputFilename(plugin: PluginData): string {
  const { schema, slug } = plugin;
  const extMap: Record<string, string> = {
    file: 'pdf',
    zip: 'zip',
    image: 'png',
    json: 'json'
  };
  const ext = extMap[schema.outputType] || 'bin';
  return `${slug}-result.${ext}`;
}
```

---

## åã€æ³¨æ„äº‹é¡¹

1. **æœåŠ¡ç«¯æ¸²æŸ“**ï¼šå·¥å…·é¡µä½¿ç”¨ Next.js æœåŠ¡ç«¯æ¸²æŸ“ï¼ŒSEO å‹å¥½
2. **å®¢æˆ·ç«¯äº¤äº’**ï¼šSchemaRenderer æ˜¯å®¢æˆ·ç«¯ç»„ä»¶ (`'use client'`)
3. **æ–‡ä»¶å¤§å°**ï¼šé»˜è®¤é™åˆ¶ 100MBï¼Œå¯åœ¨ schema.json ä¸­é…ç½®
4. **å›½é™…åŒ–**ï¼šæ‰€æœ‰ç”¨æˆ·å¯è§æ–‡æœ¬éœ€æ”¯æŒ en/zh/es ä¸‰ç§è¯­è¨€
5. **é”™è¯¯å¤„ç†**ï¼šåŠ¡å¿…å¤„ç†ç½‘ç»œé”™è¯¯å’Œæ–‡ä»¶å¤„ç†é”™è¯¯
